{"version":3,"names":[],"mappings":"","sources":["profile/create.js"],"sourcesContent":["import _ from 'lodash';\n\nconst blacklist = {locations: ['nyc2']};\n\n// Note: These are just generic coordinates for the city, not the actual\n//  location of the datacenters. If you know the actual locations, please\n//  update!\nconst physicalLocations = {\n  ams1: {lat: 52.370216, lon: 4.895168},\n  ams2: {lat: 52.370216, lon: 4.895168},\n  ams3: {lat: 52.370216, lon: 4.895168},\n  lon1: {lat: 51.507351, lon: -0.127758},\n  nyc1: {lat: 40.712784, lon: -74.005941},\n  nyc2: {lat: 40.712784, lon: -74.005941},\n  nyc3: {lat: 40.712784, lon: -74.005941},\n  sgp1: {lat: 1.352083,  lon: 103.819836},\n  sfo1: {lat: 37.774929, lon: -122.419416}\n};\n\nmodule.exports = (DOWrapper, DOToken) => {\n  const api = new DOWrapper(DOToken);\n\n  return Promise.all([\n    promise(api.sizesGetAll.bind(api))\n      .then(transformSizes)\n  ,\n    promise(api.regionsGetAll.bind(api))\n      .then(transformRegions)\n  ])\n  .then(makeProfile);\n\n  function promise(fn, ...args) {\n    return new Promise((resolve, reject) => {\n      fn(...args, (error, ...rest) => {\n        if (error) reject(error);\n        else resolve(...rest);\n      });\n    });\n  }\n\n  function transformSizes(sizes) {\n    return new Promise((resolve, reject) => {\n      resolve(_.transform(sizes.sizes, (sizes, size) => {\n        const {slug: id, memory, vcpus: cpus, disk, transfer, price_monthly, price_hourly, regions: locations} = size;\n        sizes[id] = {\n          id,\n          memory,\n          cpus,\n          disk,\n          transfer,\n          price_monthly,\n          price_hourly,\n          locations\n        };\n      }, {}));\n    });\n  }\n\n  function transformRegions(regions) {\n    return new Promise((resolve, reject) => {\n      resolve(_.transform(_.where(regions.regions, {available: true}), (regions, region) => {\n        const {slug: id, name, sizes, available} = region;\n        regions[id] = {\n          id,\n          vicinity: name,\n          physicalLocation: physicalLocations[id] || {},\n          sizes\n        };\n      }, {}));\n    });\n  }\n\n  function makeProfile(values) {\n    const [sizes, locations] = values;\n    return {\n      name: 'DigitalOcean',\n      sizes,\n      locations: _.omit(locations, blacklist.locations || [])\n    };\n  }\n};\n"],"file":"profile/create.js","sourceRoot":"/source/"}